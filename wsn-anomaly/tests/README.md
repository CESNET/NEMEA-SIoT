# Tests for WSN anomaly modules
All test input datasets contain UniRec records which simulates traffic statistics traffic captured by [NEMEA Collector](https://github.com/CESNET/siotgateway/blob/master/src/core/NemeaCollector.cpp). All test scenarios used the same configuration file [test.ini](https://github.com/CESNET/NEMEA-SIoT/blob/wsn-tests/wsn-anomaly/config.ini).

## Profile Change Detection - BLE DoS
Use Case: This test verifies profile change detection. As a test scenario are used DoS attack. To simulate DoS attack in BLE network we used a simple script that gathers data from a BLE sensor and it changes reading frequency which increase/decrease number of messages. 

Test: Learning time-series rotation, custom id, grow_up/grow_down detection

Configuration Header: {UniRec key: RX_BYTES, id: 1112}

Input Traffic: ble-dos.csv

### Input
First 8 messages are used for learning where the byte difference between two messages is 29 bytes. Next 2 messages contain valid data. From 11th received message starts DoS attack that is detected from 13th message by MOVING_AVERAGE and MOVING_VARIANCE values.
    
### Expected output
In the output are expected 11 messages indicating continuous growth of RX_BYTES. At the end, you can see grow up alert messages for AVERAGE and MOVING_AVERAGE that confirm this continuous growth.

## Data Limit Violation - Sensor data
Use Case: This test is focused on detection of violation of defined data limits. The aim is to detect unexpected violations against defined profiles configuration. The data were generated by virtual sensors in BeeeOn gateway.

Test: hard_min/hard_max detection, soft_min/soft_max detection, default id

Configuration Header: {UniRec key: VALUE, id: -}

Input Traffic: onExport-dataLimit-virtual.csv

### Input
First 4 messages are used for learning. Next 6 messages contain low values that should violate minimal configured tresholds. Last 6 messages contain high values that should violate maximal limits.

### Expected output
At first, there is minimal hard limit alert for MOVING_MEDIAN. The second alert contains minimal hard limit violation by MOVING_AVERAGE and MOVING_MEDIAN. After that, the grace period is exceeded and soft limit violation is visible. Last 4 alerts cover detection of higher values. The growth is smooth. Therefore, there is a soft limit alert followed by a hard limit alert.

## Multiple Detection - Z-Wave Connection Quality
Use Case: This test verifies the detection of multiple keys and simple store mode. The aim is to detect violations on the transport channel.

Test: store mode, filter profile values, simple learning queue, merged UniRec formats, UniRec id filtering, ignore phase

Configuration Header: {UniRec key: DROPPED, id: 1113}, {UniRec key: 22, id: LAST_RESPONSE_RTT}

Input Traffic: z-wave-connection.csv

### Input
The input contains two merged UniRec data formats using NEMEA Merger module. After learning period there is one message for each UniRec key exceeding configured thresholds.

### Expected output
One alert for the key 1113 with a maximal hard limit violation for MOVING_MEDIAN. One alert for the key 22 with a grow up limit violation for MOVING_AVERAGE.
